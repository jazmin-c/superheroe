<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CogniKids ‚Äî Rutina / Panel Padres</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800&display=swap" rel="stylesheet" />
<style>
/* estilos similares a los que hemos discutido, enfocados en suavidad y claridad */
:root {
  --bg1: #a3cdfd;
  --bg2: #fefefe;
  --accent: #7fc9ff;
  --accent-hover: #a1d6ff;
  --accent-focus: #658fd6;
  --text-primary: #034078;
  --text-secondary: #556677;
  --radius: 25px;
  --gap: 16px;
  --shadow-light: 0 4px 12px rgba(67,164,255,0.18);
  --shadow-strong: 0 8px 24px rgba(40,69,125,0.12);
}
* {
  box-sizing: border-box;
}
html, body {
  margin: 0;
  font-family: 'Nunito', sans-serif;
  background: linear-gradient(180deg, var(--bg1), var(--bg2));
  color: var(--text-primary);
  display: flex;
  justify-content: center;
  padding: 32px 16px;
}
.app {
  width: 720px;
  max-width: 100%;
  display: flex;
  flex-direction: column;
  gap: var(--gap);
}
header.app-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding-bottom: 12px;
}
.brand {
  display: flex;
  align-items: center;
  gap: 16px;
  user-select: none;
}
.logo {
  background: linear-gradient(90deg, var(--accent), var(--accent-hover));
  color: white;
  font-weight: 900;
  font-size: 32px;
  width: 60px;
  height: 60px;
  border-radius: var(--radius);
  display: grid;
  place-items: center;
  box-shadow: var(--shadow-light);
}
.title h1 {
  margin: 0;
  font-size: 24px;
  font-weight: 900;
}
.title p {
  margin: 4px 0 0 0;
  color: var(--text-secondary);
  font-weight: 600;
}
.gear {
  background: white;
  border-radius: 16px;
  box-shadow: var(--shadow-light);
  width: 48px;
  height: 48px;
  cursor: pointer;
  display: grid;
  place-items: center;
  border: 1px solid rgba(5, 38, 58, 0.06);
  transition: background-color 0.3s;
}
.gear:hover {
  background-color: var(--bg1);
}
.gear svg {
  width: 22px;
  height: 22px;
  stroke: var(--text-primary);
}
.welcome.card {
  background: white;
  border-radius: var(--radius);
  padding: 28px 32px;
  box-shadow: var(--shadow-strong);
  display: flex;
  flex-direction: column;
  gap: 20px;
  align-items: flex-start;
}
.greeting {
  display: flex;
  gap: 20px;
  align-items: center;
  width: 100%;
}
.avatar-hello {
  width: 80px;
  height: 80px;
  border-radius: var(--radius);
  background: linear-gradient(180deg, var(--bg1), var(--bg2));
  display: grid;
  place-items: center;
  font-size: 36px;
  font-weight: 900;
  color: var(--accent);
}
.welcome h2 {
  margin: 0;
  font-size: 24px;
  font-weight: 900;
}
.welcome p {
  font-weight: 600;
  color: var(--text-secondary);
  margin: 0;
}
.name-row {
  display: flex;
  gap: 16px;
  width: 100%;
}
input#nameInput {
  flex: 1;
  border: 2px solid var(--accent);
  border-radius: var(--radius);
  font-size: 18px;
  font-weight: 600;
  padding: 12px 20px;
  transition: border-color 0.3s;
}
input#nameInput:focus {
  outline: none;
  border-color: var(--accent-focus);
}
button#startBtn {
  background: var(--accent);
  color: white;
  border: none;
  border-radius: var(--radius);
  font-weight: 900;
  font-size: 18px;
  padding: 12px 24px;
  cursor: pointer;
  box-shadow: var(--shadow-light);
  transition: background-color 0.3s;
}
button#startBtn:hover {
  background: var(--accent-hover);
}
.task-view.card {
  background: white;
  border-radius: var(--radius);
  padding: 36px 48px;
  box-shadow: var(--shadow-strong);
  display: flex;
  flex-direction: column;
  gap: 20px;
  align-items:center;
  position: relative;
  width: 100%;
  max-width: 720px;
}
#childPointsCount {
  font-weight: 800;
  color: var(--accent);
  font-size: 28px;
  text-shadow: 0 0 6px #ffd700cc;
  text-align: center;
}
.task-card {
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 18px;
}
.task-step {
  width: 100%;
  max-width: 540px;
  padding: 24px;
  border-radius: var(--radius);
  background: #fff2e6;
  box-shadow: 0 6px 30px rgba(255, 165, 79, 0.3);
  text-align: center;
  font-weight: 700;
  font-size: 20px;
  color: var(--text-primary);
  transition: transform 0.35s ease, opacity 0.35s ease;
}
.task-step h3 {
  margin: 0 0 14px 0;
  font-weight: 900;
  font-size: 28px;
}
.task-step p {
  margin: 0;
  color: var(--text-secondary);
  font-weight: 600;
  font-size: 17px;
}
label {
  display: flex;
  align-items: center;
  gap: 14px;
  background: white;
  border-radius: var(--radius);
  padding: 12px 20px;
  font-size: 18px;
  color: var(--text-primary);
  box-shadow: 0 4px 12px rgba(255, 165, 79, 0.25);
  user-select: none;
  cursor: pointer;
  font-weight: 700;
}
label input[type="checkbox"] {
  transform: scale(1.3);
  cursor: pointer;
}
.controls {
  display: flex;
  gap: 20px;
  width: 100%;
  max-width: 420px;
  justify-content: center;
}
.controls .btn {
  min-width: 150px;
  font-weight: 700;
  font-size: 18px;
  padding: 14px 0;
  cursor: pointer;
  border-radius: var(--radius);
  box-shadow: 0 4px 18px rgba(67,164,255,0.18);
  transition: background-color 0.35s ease, box-shadow 0.35s ease;
}
.controls .btn-primary {
  background: linear-gradient(90deg, #7fc9ff, #a1d6ff);
  color: #034078;
}
.controls .btn-primary:hover:not(:disabled) {
  background: linear-gradient(90deg, #a1d6ff, #7fc9ff);
  box-shadow: 0 6px 20px rgba(67,164,255,0.3);
}
.controls .btn-soft {
  background: rgba(175, 210, 255, 0.3);
  color: #045a98;
  border: none;
  box-shadow: none;
  transition: background-color 0.35s ease;
}
.controls .btn-soft:hover:not(:disabled) {
  background: rgba(175, 210, 255, 0.6);
  box-shadow: 0 4px 12px rgba(175, 210, 255, 0.3);
}
#markDoneBtn {
  margin-top: 20px;
  width: 180px;
  font-weight: 700;
  font-size: 20px;
  box-shadow: 0 9px 30px rgba(255, 165, 79, 0.25);
  border-radius: var(--radius);
  cursor: pointer;
  transition: background-color 0.3s, box-shadow 0.3s;
  background: linear-gradient(90deg, #7fc9ff, #a1d6ff);
  color: #034078;
  border: none;
}
#markDoneBtn:hover:not(:disabled) {
  background: linear-gradient(90deg, #a1d6ff, #7fc9ff);
  box-shadow: 0 12px 40px rgba(67,164,255,0.4);
}
.side.card {
  border-radius: var(--radius);
  padding: 24px 32px;
  background: linear-gradient(180deg, #ffffff, #fffdfb);
  box-shadow: var(--shadow-strong);
  text-align: center;
  margin: 24px auto 0 auto;
  width: 320px;
}
.meter {
  height: 20px;
  width: 100%;
  background: #e5f0ff;
  border-radius: 20px;
  overflow: hidden;
  margin: 16px 0;
}
.meter-fill {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, #68b0ff, #2f82ff);
  transition: width 0.6s ease;
  border-radius: 20px 0 0 20px;
}
.reward-block {
  margin-top: 32px;
  padding: 18px 24px;
  border-radius: 18px;
  background: linear-gradient(135deg, #dbffff 0%, #e6fff7 100%);
  box-shadow: 0 6px 18px rgba(16, 140, 92, 0.3);
}
.reward-block strong {
  display: block;
  padding-bottom: 10px;
  font-size: 20px;
  font-weight: 800;
  color: #0b6d3b;
}
.reward-text {
  font-size: 18px;
  color: #004d26;
  padding: 8px 12px;
  border: 2px solid #a1e3c5;
  border-radius: 12px;
  background: #dff7e8;
  min-height: 56px;
  font-weight: 600;
}
.modal-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(3, 8, 15, 0.42);
  display: grid;
  place-items: center;
  z-index: 11000;
}
.modal {
  max-width: 480px;
  background: white;
  border-radius: var(--radius);
  padding: 32px;
  box-shadow: var(--shadow-strong);
  text-align: center;
}
.modal header {
  font-weight: 900;
  margin-bottom: 24px;
  font-size: 26px;
  color: #2f8aff;
}
.modal button {
  border: none;
  background: var(--accent);
  color: white;
  font-weight: 900;
  font-size: 20px;
  padding: 14px 32px;
  border-radius: var(--radius);
  cursor: pointer;
  box-shadow: 0 11px 38px rgba(36, 130, 237, 0.3);
  transition: background-color 0.3s ease;
}
.modal button:hover {
  background: var(--accent-hover);
}
</style>
</head>
<body>
<div class="app" id="app">
<header class="app-header">
  <div class="brand">
    <div class="logo">HR</div>
    <div class="title">
      <h1>CogniKids ‚Äî Aventura diaria</h1>
      <p>Rutinas simples y recompensas para motivar</p>
    </div>
  </div>
  <div class="gear" id="openParentBtn" title="Panel de Padres (protegido)">
    <svg viewBox="0 0 24 24" fill="none" aria-hidden>
      <path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z" stroke="#053047" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"></path>
      <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06A2 2 0 0 1 2.29 17.88l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09c.67 0 1.21-.3 1.51-1a1.65 1.65 0 0 0-.33-1.82l-.06-.06A2 2 0 0 1 6.12 2.29l.06.06c.5.5 1.3.65 1.98.36.7-.29 1.1-1 1.1-1.71V3a2 2 0 0 1 4 0v.09c0 .7.4 1.42 1.1 1.71.69.29 1.48.14 1.98-.36l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06c-.5.5-.65 1.3-.36 1.98.29.7 1 1.1 1.71 1.1H21a2 2 0 0 1 0 4h-.09c-.7 0-1.42.4-1.71 1z" stroke="#053047" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"></path>
    </svg>
  </div>
</header>
<main>
  <section class="welcome card" id="welcomeCard" aria-live="polite">
    <div class="greeting">
      <div class="avatar-hello">‚ú®</div>
      <div>
        <h2 id="welcomeTitle">Hola üëã ¬øC√≥mo te llamas?</h2>
        <p class="small">Escrib√≠ tu nombre para comenzar la aventura de hoy.</p>
      </div>
    </div>
    <div class="name-row" style="width:100%">
      <input id="nameInput" placeholder="Tu nombre..." aria-label="Nombre del usuario" />
      <button class="btn btn-primary" id="startBtn">Comenzar</button>
    </div>
  </section>
  <section class="task-view card" id="taskView" style="display:none;">
    <div id="childPointsCount" aria-live="polite" role="region" aria-label="Contador de estrellitas para ni√±o">Estrellitas: 0 ‚≠ê</div>
    <div class="task-card" id="taskCardContainer" aria-live="polite"></div>
    <button class="btn btn-primary" id="markDoneBtn" disabled>Marcar como completada</button>
    <div class="controls" style="margin-top:16px;">
      <button class="btn btn-soft" id="prevTaskBtn">Anterior tarea</button>
      <button class="btn btn-primary" id="nextTaskBtn">Siguiente tarea</button>
    </div>
  </section>
  <aside class="side card" aria-label="Panel de progreso y recompensas">
    <div>
      <strong>Progreso</strong>
      <div class="small">Avance de hoy</div>
      <div class="meter"><div id="meterFill" class="meter-fill"></div></div>
    </div>
    <div>
      <strong>Pr√≥xima tarea</strong>
      <div id="nextPreview" class="small">‚Äî</div>
    </div>
    <div>
      <strong>Estrellitas ganadas</strong>
      <div id="points" class="small" aria-live="polite">0</div>
    </div>
    <div class="reward-block">
      <strong>Tu recompensa</strong>
      <div id="rewardText" class="reward-text" aria-label="Texto de recompensa"></div>
    </div>
  </aside>
</main>
</div>
<div id="modalRoot" style="display:none"></div>
<script>
  const STORAGE_KEY = 'heroroutine_spa_v1';
  let state = {
    userName: '',
    points: 0,
    tasks: [
      { id:'1', icon:'ü™•', name:'Cepillarse los dientes', steps:['Poner pasta','Cepillar 2 min','Enjuagar'], completed:false, completedSteps:[] },
      { id:'2', icon:'üéí', name:'Preparar mochila', steps:['Revisar cuadernos','Poner lonchera'], completed:false, completedSteps:[] },
      { id:'3', icon:'üß∏', name:'Guardar juguetes', steps:['Recoger piezas','Guardar en caja'], completed:false, completedSteps:[] }
    ],
    realRewards: ["Una salida al parque"],
    pointsAwardedTasks: [],
  };
  const welcomeCard = document.getElementById('welcomeCard');
  const nameInput = document.getElementById('nameInput');
  const startBtn = document.getElementById('startBtn');
  const taskView = document.getElementById('taskView');
  const taskCardContainer = document.getElementById('taskCardContainer');
  const prevTaskBtn = document.getElementById('prevTaskBtn');
  const nextTaskBtn = document.getElementById('nextTaskBtn');
  const markDoneBtn = document.getElementById('markDoneBtn');
  const nextPreview = document.getElementById('nextPreview');
  const meterFill = document.getElementById('meterFill');
  const rewardTextEl = document.getElementById('rewardText');
  const pointsEl = document.getElementById('points');
  const childPointsCount = document.getElementById('childPointsCount');
  const modalRoot = document.getElementById('modalRoot');
  let currentIndex = 0;
  function saveState() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  }
  function initUI() {
    if(state.userName !== '') {
      nameInput.value = state.userName;
    }
    showWelcomeGreeting(state.userName || '');
    updateStats();
    renderTaskAt(currentIndex);
    updateNextPreview();
    renderRewardText();
  }
  function showWelcomeGreeting(name) {
    document.getElementById('welcomeTitle').textContent = `Hola, ${name} üëã ¬øEst√°s listo para tus tareas de hoy?`;
  }
  startBtn.addEventListener('click', () => {
    let name = nameInput.value.trim();
    if(name === '') name = 'Amigo';
    state.userName = name;
    saveState();
    showWelcomeGreeting(name);
    welcomeCard.style.opacity = 0;
    setTimeout(() => {
      welcomeCard.style.display = 'none';
      taskView.style.display = 'flex';
      taskView.style.opacity = 0;
      setTimeout(() => {
        taskView.style.opacity = 1;
      }, 50);
    }, 350);
    renderTaskAt(0);
  });
  prevTaskBtn.addEventListener('click', () => {
    if(currentIndex > 0) renderTaskAt(currentIndex -1);
  });
  nextTaskBtn.addEventListener('click', (e) => {
    e.preventDefault();
    const t = state.tasks[currentIndex];
    if(!t) return;
    if(t.steps && t.steps.length > 0 && (t.completedSteps || []).length !== t.steps.length){
      showToast('Primero complet√° todos los pasos');
      return;
    }
    if(currentIndex === state.tasks.length - 1){
      showFinishedModal();
      return;
    }
    if(!t.completed){
      if(!state.pointsAwardedTasks.includes(t.id)){
        state.points += 10;
        state.pointsAwardedTasks.push(t.id);
        showFloatingStars('+10 ‚≠ê', taskCardContainer);
      }
      t.completed = true;
    }
    saveState();
    currentIndex++;
    renderTaskAt(currentIndex);
    updateStats();
  });
  markDoneBtn.addEventListener('click', () => {
    const t = state.tasks[currentIndex];
    if(!t) return;
    if(t.steps && t.steps.length > 0 && (t.completedSteps || []).length !== t.steps.length){
      showToast('Primero complet√° todos los pasos');
      return;
    }
    if(!t.completed){
      if(!state.pointsAwardedTasks.includes(t.id)){
        state.points += 10;
        state.pointsAwardedTasks.push(t.id);
        showFloatingStars('+10 ‚≠ê', taskCardContainer);
      }
      t.completed = true;
    }
    saveState();
    showToast('Tarea completada +10 ‚≠ê');
    updateStats();
    renderTaskAt(currentIndex);
    setTimeout(() => {
      if(currentIndex < state.tasks.length - 1) renderTaskAt(currentIndex + 1);
      else showFinishedModal();
    }, 700);
  });
  function renderTaskAt(index){
    if(state.tasks.length === 0){
      taskCardContainer.innerHTML = `<div class="task-step"><h3>No hay tareas</h3><p>Pedile a mam√° o pap√° que agregue tareas desde el panel de padres.</p></div>`;
      nextPreview.textContent = '‚Äî';
      updateStats();
      return;
    }
    if(index < 0) index = 0;
    if(index >= state.tasks.length) index = state.tasks.length - 1;
    currentIndex = index;
    const t = state.tasks[currentIndex];
    taskCardContainer.innerHTML = '';
    const el = document.createElement('div');
    el.className = 'task-step page-enter-active';
    el.innerHTML = `
      <div style="font-size:36px">${t.icon || '‚≠ê'}</div>
      <h3>${t.name}</h3>
      <div class="small" style="margin-top:8px">${t.steps && t.steps.length > 0 ? (t.steps.length + ' pasos') : 'Sin pasos'}</div>
      <div style="margin-top:12px; width:100%"></div>
    `;
    if(t.steps && t.steps.length > 0){
      const list = document.createElement('div');
      list.style.display = 'flex';
      list.style.flexDirection = 'column';
      list.style.gap = '8px';
      list.style.marginTop = '12px';
      list.style.width = '100%';
      t.steps.forEach((s, i) => {
        const row = document.createElement('label');
        row.style.display = 'flex';
        row.style.alignItems = 'center';
        row.style.gap = '10px';
        row.style.background = 'linear-gradient(90deg,#fff,#fbfbff)';
        row.style.padding = '8px';
        row.style.borderRadius = '8px';
        const cb = document.createElement('input');
        cb.type = 'checkbox';
        cb.checked = t.completedSteps.includes(i);
        cb.addEventListener('change', () => {
          if(cb.checked){
            if(!t.completedSteps.includes(i)) t.completedSteps.push(i);
            showToast('Paso completado');
          }else{
            t.completedSteps = t.completedSteps.filter(x => x !== i);
          }
          if(t.completedSteps.length === t.steps.length && !t.completed){
            if(!state.pointsAwardedTasks.includes(t.id)){
              state.points += 10;
              state.pointsAwardedTasks.push(t.id);
              showFloatingStars('+10 ‚≠ê', taskCardContainer);
            }
            t.completed = true;
            updateControls();
          }else if(t.completed && t.completedSteps.length !== t.steps.length){
            t.completed = false;
            const idx = state.pointsAwardedTasks.indexOf(t.id);
            if(idx !== -1){
              state.pointsAwardedTasks.splice(idx, 1);
              state.points -= 10;
            }
            updateControls();
          }
          saveState();
          updateStats();
          renderTaskAt(currentIndex);
          updateNextPreview();
        });
        const txt = document.createElement('div');
        txt.textContent = s;
        txt.style.flex = '1';
        row.appendChild(cb);
        row.appendChild(txt);
        list.appendChild(row);
      });
      el.appendChild(list);
    }
    const hint = document.createElement('div');
    hint.className = 'small';
    const completedSteps = t.completedSteps ? t.completedSteps.length : 0;
    if(t.completed){
      hint.textContent = 'Tarea completada ‚úÖ';
    }else if(t.steps && t.steps.length > 0 && completedSteps === t.steps.length){
      hint.textContent = 'Todos los pasos listos.';
    }else if(t.steps && t.steps.length > 0){
      hint.textContent = `Pasos completados: ${completedSteps} / ${t.steps.length}`;
    }else{
      hint.textContent = 'Tarea sin pasos.';
    }
    el.appendChild(hint);
    taskCardContainer.appendChild(el);
    updateControls();
    updateNextPreview();
  }
  function updateControls(){
    prevTaskBtn.disabled = currentIndex === 0;
    nextTaskBtn.disabled = currentIndex >= state.tasks.length - 1;
    const t = state.tasks[currentIndex];
    markDoneBtn.disabled = !t || t.completed;
  }
  function updateStats(){
    const total = state.tasks.length;
    const done = state.tasks.filter(t => t.completed).length;
    const percent = total ? Math.round((done / total) * 100) : 0;
    meterFill.style.width = percent + '%';
    pointsEl.textContent = state.points;
    if(childPointsCount){
      childPointsCount.textContent = `Estrellitas: ${state.points} ‚≠ê`;
    }
  }
  function updateNextPreview(){
    if(state.tasks.length === 0){
      nextPreview.textContent = '‚Äî';
      return;
    }
    const idx = Math.min(currentIndex + 1, state.tasks.length - 1);
    const next = state.tasks[idx];
    nextPreview.textContent = next ? `${next.icon || ''} ${next.name}` : '‚Äî';
    updateStats();
  }
  function showFloatingStars(text, container){
    const star = document.createElement('div');
    star.textContent = text;
    star.style.position = 'absolute';
    star.style.left = '50%';
    star.style.top = '50%';
    star.style.transform = 'translate(-50%, -50%)';
    star.style.fontSize = '24px';
    star.style.fontWeight = '700';
    star.style.color = '#FFD700';
    star.style.opacity = 1;
    star.style.pointerEvents = 'none';
    star.style.transition = 'all 1s ease-out';
    container.appendChild(star);
    setTimeout(() => {
      star.style.transform = 'translate(-50%, -120%)';
      star.style.opacity = 0;
    }, 20);
    setTimeout(() => star.remove(), 1000);
  }
  function showToast(msg){
    const t = document.createElement('div');
    t.textContent = msg;
    t.style.position = 'fixed';
    t.style.left = '50%';
    t.style.transform = 'translateX(-50%)';
    t.style.top = '20px';
    t.style.padding = '10px 14px';
    t.style.background = 'linear-gradient(90deg,#ffd6a5,#ffd6a5)';
    t.style.borderRadius = '10px';
    t.style.boxShadow = '0 8px 24px rgba(12,20,30,0.08)';
    t.style.zIndex = 12000;
    document.body.appendChild(t);
    setTimeout(() => {
      t.style.transition = 'opacity .45s';
      t.style.opacity = 0;
      setTimeout(() => t.remove(), 450);
    }, 1600);
  }
  function createModal(innerHTML, wide = false){
    modalRoot.innerHTML = '';
    modalRoot.style.display = 'block';
    modalRoot.innerHTML = `<div class="modal-backdrop"><div class="modal" style="${wide ? '' : ''}">${innerHTML}</div></div>`;
    modalRoot.querySelector('.modal-backdrop').addEventListener('click', (e)=>{
      if(e.target === modalRoot.querySelector('.modal-backdrop'))
        closeModal();
    });
    return modalRoot.querySelector('.modal');
  }
  function closeModal(){
    modalRoot.innerHTML = '';
    modalRoot.style.display = 'none';
  }
  openParentBtn.addEventListener('click', () => openPasswordPrompt());
  function openPasswordPrompt(){
    const md = createModal(`
      <header><strong>Acceso Panel de Padres</strong><button id="closeX" aria-label="cerrar">‚úñ</button></header>
      <div style="margin-top:12px">
        <p class="small">Ingres√° la contrase√±a para acceder y administrar tareas y recompensas.</p>
        <div class="form-row" style="margin-top:8px">
          <input id="parentPass" placeholder="Contrase√±a" type="password" />
          <button class="btn btn-primary" id="parentEnter">Entrar</button>
        </div>
      </div>
    `);
    md.querySelector('#closeX').addEventListener('click', () => closeModal());
    md.querySelector('#parentEnter').addEventListener('click', () => {
      const val = md.querySelector('#parentPass').value;
      if(val === 'admin123'){
        closeModal();
        openParentPanel();
      } else {
        alert('Contrase√±a incorrecta');
      }
    });
    md.querySelector('#parentPass').addEventListener('keydown', (e) => {
      if(e.key === 'Enter') md.querySelector('#parentEnter').click();
    });
  }
  function openParentPanel(){
    const modalHtml = `
      <header><strong>Panel de Padres</strong><div style="display:flex;gap:8px"><button id="closePanel" class="btn btn-soft">Cerrar</button></div></header>
      <div style="margin-top:10px; display:grid; grid-template-columns: 1fr 1fr; gap:12px;">
        <div>
          <label class="small">Nombre tarea</label>
          <input id="p_task_name" placeholder="Ej: Cepillarse los dientes" />
        </div>
        <div>
          <label class="small">Emoji / √çcono</label>
          <input id="p_task_icon" placeholder="ü™•" maxlength="3" />
        </div>
        <div style="grid-column:1/-1">
          <label class="small">Pasos (separados por coma)</label>
          <textarea id="p_task_steps" rows="2" placeholder="Poner pasta, Cepillar, Enjuagar"></textarea>
        </div>
        <div style="grid-column:1/-1; display:flex; gap:8px; justify-content:flex-start;">
          <button id="p_add" class="btn btn-primary">Agregar tarea</button>
          <button id="p_save" class="btn btn-soft">Guardar cambios</button>
        </div>
      </div>
      <div style="margin-top:12px">
        <h3>Tareas actuales</h3>
        <div class="task-list-parent" id="parentTaskList"></div>
      </div>
      <hr style="margin:20px 0; border:none; border-top:1px solid rgba(5,38,58,0.1);" />
      <div>
        <label class="small"><strong>Editar recompensa real</strong></label>
        <textarea id="p_reward" rows="2" placeholder="Ejemplo: Una salida al parque" class="reward-editable"></textarea>
        <button id="p_reward_save" class="btn btn-primary" style="margin-top:8px;">Guardar recompensa</button>
      </div>
    `;
    const md = createModal(modalHtml, true);
    md.querySelector('#closePanel').addEventListener('click', () => closeModal());
    md.querySelector('#p_add').addEventListener('click', () => {
      const name = md.querySelector('#p_task_name').value.trim();
      const icon = md.querySelector('#p_task_icon').value.trim() || 'üìù';
      const stepsRaw = md.querySelector('#p_task_steps').value.trim();
      const steps = stepsRaw ? stepsRaw.split(',').map(x=>x.trim()).filter(Boolean) : [];
      if(!name) return alert('Ingrese nombre de tarea');
      const newTask = { id: Date.now(), icon, name, steps, completed: false, completedSteps: [] };
      state.tasks.push(newTask);
      saveState();
      renderParentTaskList(md);
      renderTaskAt(currentIndex);
      updateStats();
      showToast('Tarea agregada');
      md.querySelector('#p_task_name').value = '';
      md.querySelector('#p_task_icon').value = '';
      md.querySelector('#p_task_steps').value = '';
    });
    md.querySelector('#p_save').addEventListener('click', () => {
      saveState();
      renderParentTaskList(md);
      showToast('Cambios guardados');
    });
    md.querySelector('#p_reward_save').addEventListener('click', () => {
      const rewardText = md.querySelector('#p_reward').value.trim();
      if(rewardText.length === 0){
        alert('La recompensa no puede estar vac√≠a.');
        return;
      }
      state.realRewards = [rewardText];
      saveState();
      renderRewardText();
      showToast('Recompensa guardada');
    });
    md.querySelector('#p_reward').value = state.realRewards.length > 0 ? state.realRewards[0] : '';
    renderParentTaskList(md);
  }
  // ---------------------------------------------------
  // DELEGACI√ìN DE EVENTOS PARA BOTONES ELIMINAR
  // ---------------------------------------------------
  document.addEventListener('click', e => {
    if (e.target.classList.contains('btn-soft') && e.target.getAttribute('aria-label') === 'Eliminar tarea') {
      const idx = parseInt(e.target.getAttribute('data-idx'));
      if (confirm(`Eliminar tarea "${state.tasks[idx]?.name}"?`)) {
        state.tasks.splice(idx, 1);
        saveState();
        // Reabrir panel padres modal si est√° abierto
        const md = document.querySelector('.modal');
        if (md) {
          renderParentTaskList(md);
        }
        renderTaskAt(currentIndex);
        updateStats();
      }
    }
  });
</script>
</body>
</html>
